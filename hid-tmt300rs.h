#include "hid-tm.h"

#define T300RS_MAX_EFFECTS FF_MAX_EFFECTS
#define T300RS_BUFFER_LENGTH 64

#define CLAMP_VALUE_U16(x) ((unsigned short)((x) > 0xffff ? 0xffff : (x)))
#define SCALE_VALUE_U16(x, bits) (CLAMP_VALUE_U16(x) >> (16 - bits))

spinlock_t lock;
unsigned long lock_flags;

static const signed short t300rs_ff_effects[] = {
    FF_CONSTANT,
    FF_RAMP,
    FF_SPRING,
    FF_DAMPER,
    FF_FRICTION,
    FF_INERTIA,
    FF_PERIODIC,
    FF_SINE,
    FF_TRIANGLE,
    FF_SQUARE,
    FF_SAW_UP,
    FF_SAW_DOWN,
    FF_AUTOCENTER,
    FF_GAIN,
    -1
};

struct t300rs_device_entry {
    struct hid_device *hdev;
    struct input_dev *input_dev;
    struct hid_report *report;
    struct hid_field *ff_field;
    struct usb_device *usbdev;
    struct usb_interface *usbif;

    spinlock_t lock;
    unsigned long lock_flags;
    
    u16 range;
};

struct t300rs_data{
    unsigned long quirks;
    void *device_props;
};

static __u8 t300rs_rdesc_fixed[] = {0x05, 0x01, 0x09, 0x04, 0xa1, 0x01, 0x09, 0x01, 0xa1, 0x00, 0x85, 0x07, 0x09, 0x30, 0x15, 0x00, 0x27, 0xff, 0xff, 0x00, 0x00, 0x35, 0x00, 0x47, 0xff, 0xff, 0x00, 0x00, 0x75, 0x10, 0x95, 0x01, 0x81, 0x02, 0x09, 0x31, 0x26, 0xff, 0x03, 0x46, 0xff, 0x03, 0x81, 0x02, 0x09, 0x35, 0x81, 0x02, 0x09, 0x36, 0x81, 0x02, 0x81, 0x03, 0x05, 0x09, 0x19, 0x01, 0x29, 0x0d, 0x25, 0x01, 0x45, 0x01, 0x75, 0x01, 0x95, 0x0d, 0x81, 0x02, 0x75, 0x0b, 0x95, 0x01, 0x81, 0x03, 0x05, 0x01, 0x09, 0x39, 0x25, 0x07, 0x46, 0x3b, 0x01, 0x55, 0x00, 0x65, 0x14, 0x75, 0x04, 0x81, 0x42, 0x65, 0x00, 0x81, 0x03, 0x85, 0x0a, 0x06, 0x00, 0xff, 0x09, 0x0a, 0x75, 0x08, 0x95, 0x3f, 0x26, 0xff, 0x7f, 0x16, 0x00, 0x80, 0x46, 0xff, 0x7f, 0x36, 0x00, 0x80, 0x91, 0x02, 0x85, 0x02, 0x09, 0x02, 0x81, 0x02, 0x09, 0x14, 0x85, 0x14, 0x81, 0x02, 0xc0, 0xc0,};

